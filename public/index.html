<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Task Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .day-column {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            min-height: 150px;
        }

        .day-header {
            font-weight: bold;
            font-size: 1.1em;
            color: #667eea;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
        }

        .task-pool-section {
            background: #fff9e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            border: 2px solid #ffd700;
        }

        .task-pool-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .task-pool-header h2 {
            color: #333;
            font-size: 1.3em;
        }

        .add-task-form {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .add-task-form input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
        }

        .add-task-form button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        .add-task-form button:hover {
            background: #5568d3;
        }

        .task-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: move;
            transition: all 0.3s;
        }

        .task-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .task-item.dragging {
            opacity: 0.5;
        }

        .task-content {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .task-text {
            flex: 1;
            font-size: 1em;
            color: #333;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .recycle-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
        }

        .recycle-btn:hover {
            background: #45a049;
        }

        .day-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .day-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: bold;
            transition: background 0.3s;
        }

        .day-btn:hover {
            background: #5568d3;
        }

        .delete-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            transition: background 0.3s;
        }

        .delete-btn:hover {
            background: #da190b;
        }

        .completed-section {
            background: #e8f5e9;
            border-radius: 8px;
            padding: 20px;
            border: 2px solid #4CAF50;
        }

        .completed-section h2 {
            color: #2e7d32;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .task-item.completed .task-text {
            text-decoration: line-through;
            color: #666;
        }

        .drag-over {
            background: #e3f2fd;
            border-color: #2196F3;
        }

        .error-banner {
            background: #ffebee;
            border: 2px solid #f44336;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            color: #c62828;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        @media (max-width: 768px) {
            .days-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“… Weekly Task Manager</h1>
        <div id="errorBanner"></div>

        <!-- Day Columns -->
        <div class="days-grid" id="daysGrid">
            <div class="day-column" data-day="monday" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                <div class="day-header">Monday</div>
                <div class="day-tasks" id="monday-tasks"></div>
            </div>
            <div class="day-column" data-day="tuesday" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                <div class="day-header">Tuesday</div>
                <div class="day-tasks" id="tuesday-tasks"></div>
            </div>
            <div class="day-column" data-day="wednesday" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                <div class="day-header">Wednesday</div>
                <div class="day-tasks" id="wednesday-tasks"></div>
            </div>
            <div class="day-column" data-day="thursday" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                <div class="day-header">Thursday</div>
                <div class="day-tasks" id="thursday-tasks"></div>
            </div>
            <div class="day-column" data-day="friday" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                <div class="day-header">Friday</div>
                <div class="day-tasks" id="friday-tasks"></div>
            </div>
            <div class="day-column" data-day="saturday" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                <div class="day-header">Saturday</div>
                <div class="day-tasks" id="saturday-tasks"></div>
            </div>
            <div class="day-column" data-day="sunday" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                <div class="day-header">Sunday</div>
                <div class="day-tasks" id="sunday-tasks"></div>
            </div>
        </div>

        <!-- Task Pool -->
        <div class="task-pool-section">
            <div class="task-pool-header">
                <h2>ðŸ“‹ Task Pool</h2>
            </div>
            <div class="add-task-form">
                <input type="text" id="newTaskInput" placeholder="Enter a new task..." />
                <button onclick="addTask()">Add Task</button>
            </div>
            <div id="taskPool"></div>
        </div>

        <!-- Completed Tasks -->
        <div class="completed-section">
            <h2>âœ… Completed Tasks</h2>
            <div id="completedTasks"></div>
        </div>
    </div>

    <script>
        const API_URL = '/api';
        let tasks = [];
        let draggedTaskId = null;

        // Show error banner
        function showError(message) {
            const banner = document.getElementById('errorBanner');
            banner.className = 'error-banner';
            banner.textContent = 'âš ï¸ ' + message;
            setTimeout(() => {
                banner.textContent = '';
                banner.className = '';
            }, 5000);
        }

        // Load tasks from API
        async function loadTasks() {
            try {
                const response = await fetch(`${API_URL}/tasks`);
                if (!response.ok) throw new Error('Failed to load tasks');
                tasks = await response.json();
                renderAllTasks();
            } catch (error) {
                console.error('Error loading tasks:', error);
                showError('Failed to load tasks. Please refresh the page.');
            }
        }

        // Add new task
        async function addTask() {
            const input = document.getElementById('newTaskInput');
            const text = input.value.trim();
            
            if (text === '') return;

            try {
                const response = await fetch(`${API_URL}/tasks`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: text,
                        day: 'pool',
                        completed: 0,
                        position: tasks.filter(t => t.day === 'pool').length
                    })
                });

                if (!response.ok) throw new Error('Failed to create task');
                
                const newTask = await response.json();
                tasks.push(newTask);
                input.value = '';
                renderAllTasks();
            } catch (error) {
                console.error('Error creating task:', error);
                showError('Failed to create task. Please try again.');
            }
        }

        // Update task
        async function updateTask(taskId, updates) {
            try {
                const response = await fetch(`${API_URL}/tasks/${taskId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updates)
                });

                if (!response.ok) throw new Error('Failed to update task');
                
                const taskIndex = tasks.findIndex(t => t.id === taskId);
                if (taskIndex !== -1) {
                    tasks[taskIndex] = { ...tasks[taskIndex], ...updates };
                }
                
                renderAllTasks();
            } catch (error) {
                console.error('Error updating task:', error);
                showError('Failed to update task. Please try again.');
            }
        }

        // Move task to day
        async function moveToDay(taskId, day) {
            await updateTask(taskId, { day: day, completed: 0 });
        }

        // Recycle task back to pool
        async function recycleTask(taskId) {
            await updateTask(taskId, { day: 'pool', completed: 0 });
        }

        // Toggle task completion
        async function toggleComplete(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                const newCompleted = task.completed ? 0 : 1;
                const newDay = newCompleted ? 'completed' : task.day;
                await updateTask(taskId, { completed: newCompleted, day: newDay });
            }
        }

        // Delete task
        async function deleteTask(taskId) {
            if (!confirm('Are you sure you want to delete this task?')) return;
            
            try {
                const response = await fetch(`${API_URL}/tasks/${taskId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('Failed to delete task');
                
                tasks = tasks.filter(t => t.id !== taskId);
                renderAllTasks();
            } catch (error) {
                console.error('Error deleting task:', error);
                showError('Failed to delete task. Please try again.');
            }
        }

        // Render a single task
        function renderTask(task) {
            const div = document.createElement('div');
            div.className = 'task-item' + (task.completed ? ' completed' : '');
            div.draggable = true;
            div.dataset.taskId = task.id;
            div.ondragstart = dragStart;
            div.ondragend = dragEnd;

            const contentDiv = document.createElement('div');
            contentDiv.className = 'task-content';

            const textSpan = document.createElement('span');
            textSpan.className = 'task-text';
            textSpan.textContent = task.text;
            contentDiv.appendChild(textSpan);

            if (task.day !== 'pool' && task.day !== 'completed') {
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'task-checkbox';
                checkbox.checked = task.completed;
                checkbox.onchange = () => toggleComplete(task.id);
                contentDiv.appendChild(checkbox);

                const recycleBtn = document.createElement('button');
                recycleBtn.className = 'recycle-btn';
                recycleBtn.innerHTML = 'â™»ï¸';
                recycleBtn.onclick = () => recycleTask(task.id);
                contentDiv.appendChild(recycleBtn);
            }

            div.appendChild(contentDiv);

            if (task.day === 'pool') {
                const buttonsDiv = document.createElement('div');
                buttonsDiv.className = 'day-buttons';

                const days = [
                    { name: 'Mo', value: 'monday' },
                    { name: 'Tu', value: 'tuesday' },
                    { name: 'We', value: 'wednesday' },
                    { name: 'Th', value: 'thursday' },
                    { name: 'Fr', value: 'friday' },
                    { name: 'Sa', value: 'saturday' },
                    { name: 'Su', value: 'sunday' }
                ];

                days.forEach(day => {
                    const btn = document.createElement('button');
                    btn.className = 'day-btn';
                    btn.textContent = day.name;
                    btn.onclick = () => moveToDay(task.id, day.value);
                    buttonsDiv.appendChild(btn);
                });

                div.appendChild(buttonsDiv);
            }

            if (task.day === 'completed') {
                const buttonsDiv = document.createElement('div');
                buttonsDiv.className = 'day-buttons';

                const days = [
                    { name: 'Mo', value: 'monday' },
                    { name: 'Tu', value: 'tuesday' },
                    { name: 'We', value: 'wednesday' },
                    { name: 'Th', value: 'thursday' },
                    { name: 'Fr', value: 'friday' },
                    { name: 'Sa', value: 'saturday' },
                    { name: 'Su', value: 'sunday' }
                ];

                days.forEach(day => {
                    const btn = document.createElement('button');
                    btn.className = 'day-btn';
                    btn.textContent = day.name;
                    btn.onclick = () => moveToDay(task.id, day.value);
                    buttonsDiv.appendChild(btn);
                });

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = 'Delete';
                deleteBtn.onclick = () => deleteTask(task.id);
                buttonsDiv.appendChild(deleteBtn);

                div.appendChild(buttonsDiv);
            }

            return div;
        }

        // Render all tasks
        function renderAllTasks() {
            document.getElementById('taskPool').innerHTML = '';
            document.getElementById('completedTasks').innerHTML = '';
            document.querySelectorAll('.day-tasks').forEach(el => el.innerHTML = '');

            tasks.forEach(task => {
                const taskElement = renderTask(task);
                
                if (task.day === 'pool') {
                    document.getElementById('taskPool').appendChild(taskElement);
                } else if (task.day === 'completed') {
                    document.getElementById('completedTasks').appendChild(taskElement);
                } else {
                    const dayContainer = document.getElementById(`${task.day}-tasks`);
                    if (dayContainer) {
                        dayContainer.appendChild(taskElement);
                    }
                }
            });
        }

        // Drag and drop
        function dragStart(e) {
            draggedTaskId = parseInt(e.target.dataset.taskId);
            e.target.classList.add('dragging');
        }

        function dragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function allowDrop(e) {
            e.preventDefault();
            const column = e.target.closest('.day-column');
            if (column) column.classList.add('drag-over');
        }

        function dragLeave(e) {
            const column = e.target.closest('.day-column');
            if (column) column.classList.remove('drag-over');
        }

        function drop(e) {
            e.preventDefault();
            const column = e.target.closest('.day-column');
            if (column) {
                column.classList.remove('drag-over');
                const day = column.dataset.day;
                if (draggedTaskId && day) {
                    moveToDay(draggedTaskId, day);
                }
            }
        }

        // Enter key to add task
        document.getElementById('newTaskInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addTask();
        });

        // Load tasks on page load
        loadTasks();
    </script>
</body>
</html>
